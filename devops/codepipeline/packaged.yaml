Resources:
  AppPipelineRole:
    Type: AWS::IAM::Role
    Properties:
      RoleName: code-pipeline-role
      AssumeRolePolicyDocument:
        Version: '2012-10-17'
        Statement:
        - Sid: ''
          Effect: Allow
          Principal:
            Service:
            - codepipeline.amazonaws.com
          Action:
          - sts:AssumeRole
      ManagedPolicyArns:
      - arn:aws:iam::aws:policy/AmazonS3FullAccess
      - arn:aws:iam::aws:policy/AmazonSNSFullAccess
  AppPipeline:
    Type: AWS::CodePipeline::Pipeline
    Properties:
      Name: revision-codepipeline
      RoleArn:
        Fn::GetAtt:
        - AppPipelineRole
        - Arn
      ArtifactStore:
        Type: S3
        Location: codepipeline-source-935529178062
      Stages:
      - Name: Source
        Actions:
        - Name: SourceAction
          ActionTypeId:
            Category: Source
            Owner: AWS
            Version: 1
            Provider: S3
          OutputArtifacts:
          - Name: SourceOutput
          Configuration:
            S3Bucket: codepipeline-source-935529178062
            S3ObjectKey: build.zip
          RunOrder: 1
      - Name: WaitAnswer
        Actions:
        - Name: ManualAprove
          ActionTypeId:
            Category: Approval
            Owner: AWS
            Provider: Manual
            Version: 1
          Configuration:
            NotificationArn: arn:aws:sns:eu-west-3:935529178062:EmailNotified
      - Name: Release
        Actions:
        - Name: Release
          InputArtifacts:
          - Name: SourceOutput
          ActionTypeId:
            Category: Deploy
            Owner: AWS
            Provider: S3
            Version: 1
          Configuration:
            BucketName: codepipeline-source-935529178062
            Extract: false
            ObjectKey: release.zip
